buildspec.yml

  version: 0.2

phases:
  install:
    runtime-version:
        golang: latest
  pre_build:
    commands:
      - aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin 003150130236.dkr.ecr.ap-northeast-2.amazonaws.com

  build:
    commands:
      - go build gateway.go
      - docker build -t gateway .


  post_build:
    commands:
      - docker tag gateway:latest 003150130236.dkr.ecr.ap-northeast-2.amazonaws.com/gateway:latest
      - docker push 003150130236.dkr.ecr.ap-northeast-2.amazonaws.com/gateway:latest
      
      
artifacts:
  files:
    - gateway
    - appspec.yml
    - start.sh
    - stop.sh
      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
appspec.yml

  version: 0.0
os: linux
files:
  - source: /
    destination: ./
hooks:
  ApplicationStart:
    - location: start.sh
      runas: root

  ApplicationStop:
    - location: stop.sh
      runas: root
  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

start.sh

#!/bin/bash
./gateway > /dev/null 2> /dev/null < /dev/null &

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  stop.sh
  
#!/bin/bash
killall gateway

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Dockerfile

FROM golang
WORKDIR /app
COPY gateway .
CMD ["./gateway"]

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------






  
